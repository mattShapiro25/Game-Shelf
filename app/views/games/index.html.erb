<head>
  <title>Games Page</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag 'application', 'browse', media: 'all' %>
</head>
<body>
    <% if flash[:notice] %>
        <div class="flash-sucess">
            <%= flash[:notice]%>
        </div>
    <% end %>

    <header class="header">
        <div class="logo">Logo</div>
        <div class="search-form">
            <%= form_with url: games_path, method: :get, class: "search-form-container" do |form| %>
                <div class="form-group">
                <%= form.text_field :query, value: @query_filt, class: "form-input", placeholder: "Search for games" %>
                <div class="form-actions">
                <%= form.submit "Search", class: "btn btn-primary" %>
                <% if @query_filt.present? %>
                    <%= link_to "Back to all games", games_path, class: "btn btn-light" %>
                <% end %>
                </div>
                </div>
            <% end %>
            </div>
        <a href="<%= user_path(current_user.id) %>">
            <div class="profile-icon"><%= current_user.email[0].upcase %></div>
        </a>
    </header>

    <div class="container">
        <div class="row">
            <h1 class="title">Browse Games</h1>

            <h2 class="section-heading">Top Rated Games</h2>
            <section class="games" id="games-section">
                <% @top.each do |game| %>
                    <a href="<%= game_path(game) %>" class="game-card">
                    <img src="<%= game.image %>" alt="<%= game.name %>" class="game-image">
                    <h2 class="game-title"><%= game.name %></h2>
                    <p class="game-rating">Rating: <%= game.avg_rating %></p>
                    </a>
                <% end %>

            <div id="more-games" style="display: none;">
                <% @top_more.each do |game| %>
                    <a href="<%= game_path(game) %>" class="game-card">
                    <img src="<%= game.image %>" alt="<%= game.name %>" class="game-image">
                    <h2 class="game-title"><%= game.name %></h2>
                    <p class="game-rating">Rating: <%= game.avg_rating %></p>
                    </a>
                <% end %>
            </div>

            <!-- Toggle button -->
            <button id="toggle-games-btn" class="btn btn-primary" onclick="toggleGames()">Show More</button>
            </section>


            <section class="games">
                <% @games.each do |game| %>
                    <a href="<%= game_path(game) %>" class="game-card">
                    <img src="<%= game.image %>" alt="<%= game.name %>" class="game-image">
                    <h2 class="game-title"><%= game.name %></h2>
                    <p class="game-rating">Rating: <%= game.avg_rating %></p>
                    </a>
                <% end %>
            </section>
        </div>
    </div>
</body>


<script>
  // Ensure the DOM is fully loaded before accessing elements
  document.addEventListener('DOMContentLoaded', function() {
    function toggleGames() {
      var moreGames = document.getElementById("more-games");
      var toggleButton = document.getElementById("toggle-games-btn");

      if (moreGames.style.display === "none") {
        moreGames.style.display = "block";
        toggleButton.textContent = "Show Less";
      } else {
        moreGames.style.display = "none";
        toggleButton.textContent = "Show More";
      }
    }

    // Attach the click event to the button
    const toggleButton = document.getElementById("toggle-games-btn");
    if (toggleButton) {
      toggleButton.addEventListener("click", toggleGames);
    }
  });
</script>